<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <record id="dte_document_a4_paperformat" model="report.paperformat">
            <field name="name">DTE_DOCUMENT: A4</field>
            <field name="default" eval="True"/>
            <field name="format">A4</field>
            <field name="page_height">0</field>
            <field name="page_width">0</field>
            <field name="orientation">Portrait</field>
            <field name="margin_top">5</field>
            <field name="margin_bottom">5</field>
            <field name="margin_left">5</field>
            <field name="margin_right">5</field>
            <field name="header_line" eval="False"/>
            <field name="header_spacing">0</field>
            <field name="dpi">80</field>
        </record>

        <report
                id="report_mail_message_dte_document"
                model="mail.message.dte.document"
                string="Documento PDF"
                name="mblz_la_invernada.action_report_mail_message_dte_document"
                file="mblz_la_invernada.action_report_mail_message_dte_document"
                paperformat="mblz_la_invernada.dte_document_a4_paperformat"
                report_type="qweb-pdf"/>

        <template id="action_report_mail_message_dte_document">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="doc">
                    <t t-call="web.basic_layout">
                        <div class="page">
                            <style>
                                .page {
                                font-size: 12px;
                                font-family: sans-serif;
                                }

                                .box-title{
                                border: 2px solid #3e423f;
                                }

                                .report-logo{
                                max-height:70px;
                                max-width:100px;
                                }

                                .custom-items {
                                list-style-type: none;
                                padding-left: 0px;
                                }

                                .custom-items .title {
                                font-size: 15px;
                                color: red;
                                }

                                .box-invoice {
                                border: 1px solid black;
                                background: #dedede;
                                font-size: 11px;
                                font-weight: bold;
                                display: block;
                                }

                                .box-invoice .custom-items {
                                font-size: 14px;
                                display: block;
                                }

                                .invoice-type {
                                font-weight: bolder;
                                border: 2px solid black;
                                border-radius: 7px;
                                }

                                .company-label {
                                font-size: 12px;
                                }

                                .invoice-type {
                                font-size: 18px;
                                }

                                .company-label .address {
                                font-size: 9px;
                                color: black;
                                }

                                .header-invoice {
                                border: 1px solid black;
                                border-radius: 7px;
                                }


                                .footer-divider {
                                border-top: 1px solid black;
                                }

                                .footer-invoice td {
                                font-size: 12px;
                                border-collapse: collapse;
                                }

                                .detail-invoice th {
                                border: 1px solid black;
                                }

                                .detail-invoice td {
                                font-size: 11px;
                                border: 1px solid black;
                                border-collapse: collapse;
                                }

                                .detail-invoice-aux td {
                                font-size: 10px;
                                border: 1px solid black;
                                border-bottom: 1px solid black;
                                border-collapse: collapse;
                                }


                                table { page-break-after:auto }
                                tr { page-break-inside:avoid; page-break-after:auto }
                                td { page-break-inside:avoid; page-break-after:auto }
                                thead { display: table-row-group; }
                            </style>

                            <h5 class="text-center mt-5">Documento electrónico recibido</h5>
                            <div class="container border border-secondary">
                                <t t-set="xml_document_data" t-value="doc._document_data()"/>
                                <t t-set="xml_emisor" t-value="xml_document_data['Encabezado']['Emisor']"/>
                                <t t-set="xml_receptor" t-value="xml_document_data['Encabezado']['Receptor']"/>
                                <t t-set="xml_details" t-value="xml_document_data['Detalle']"/>
                                <t t-set="xml_totals" t-value="xml_document_data['Encabezado']['Totales']"/>
                                <div class="row mt-3 pb-3"
                                     style="font-size: 11px; !important;">
                                    <div class="col-7 mt-3">
                                        <div class="ml-2">
                                            <strong><t t-esc="xml_emisor['RznSoc']"/></strong><br/>
                                            <span>Giro: <t t-esc="xml_emisor['GiroEmis']"/></span><br/>
                                            <span><t t-esc="xml_emisor['DirOrigen']"/></span>
                                        </div>

                                        <div class="border border-secondary mb-3 mt-1">

                                            <table class="m-2 p-2">
                                                <tr>
                                                    <th>SEÑOR(ES): </th>
                                                    <td class="pl-1">
                                                        <span t-if="xml_receptor.get('RznSocRecep')"
                                                              t-esc="xml_receptor['RznSocRecep']"/>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th>RUT: </th>
                                                    <td class="pl-1">
                                                        <span t-if="xml_receptor.get('RUTRecep')"
                                                              t-esc="xml_receptor['RUTRecep']"/>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th>GIRO: </th>
                                                    <td class="pl-1">
                                                        <span t-if="xml_receptor.get('GiroRecep')"
                                                              t-esc="xml_receptor['GiroRecep']"/>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th>DIRECCIÓN: </th>
                                                    <td class="pl-1">
                                                        <span t-if="xml_receptor.get('DirRecep')"
                                                              t-esc="xml_receptor['DirRecep']"/>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th>COMUNA: </th>
                                                    <td class="pl-1">
                                                        <span t-if="xml_receptor.get('CmnaRecep')"
                                                              t-esc="xml_receptor['CmnaRecep']"/>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th>CIUDAD: </th>
                                                    <td class="pl-1">
                                                        <span t-if="xml_receptor.get('CiudadRecep')"
                                                              t-esc="xml_receptor['CiudadRecep']"/>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th>CONTACTO: </th>
                                                    <td class="pl-1">
                                                        <span t-if="xml_receptor.get('Contacto')"
                                                              t-esc="xml_receptor['Contacto']"/>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="col-5 mt-3">
                                        <div class="text-center text-danger pt-3"
                                             style="border: 2px solid red !important; font-size: 14px; font-weight: bold;">
                                            <div>
                                                RUT: <t t-esc="xml_emisor['RUTEmisor']"/>
                                            </div>
                                            <div class="pt-2">
                                                <span class="text-uppercase" t-esc="doc.document_class_id.name"/>
                                            </div>
                                            <div class="pt-2 pb-2">
                                                Nº: <span style="line-height: 200%;" t-esc="doc.number"/>
                                            </div>
                                        </div>
                                        <div class="text-center text-uppercase text-danger mt-1"
                                             style="font-weight: bold">
                                            S.I.I. - <span class="text-center"
                                                           t-esc="doc.company_id.partner_id.city_id.name"/>
                                        </div>

                                        <div class="text-center mt-3">
                                            Fecha Emisión:
                                            <span class="text-center" t-esc="doc.date" t-options="{'widget': 'date'}"/>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-12">
                                        <table class="col-12">
                                            <thead class="detail-invoice bg-light">
                                                <tr style="background-color:#f1f2f6;">
                                                    <th class="text-center p-1 pb-3">Código</th>
                                                    <th class="text-center p-1 pb-3">Descripción</th>
                                                    <th class="text-center p-1">Cantidad</th>
                                                    <th class="text-right p-1 pb-3">Precio</th>
                                                    <th class="text-right p-1 pb-3">% Imp. Adic.</th>
                                                    <th class="text-right p-1 pb-3">% Desc.</th>
                                                    <th class="text-right p-1 pb-3">Valor</th>
                                                </tr>
                                            </thead>
                                            <tbody class="detail-invoice">
                                                <t t-foreach="xml_details" t-as="line">
                                                    <tr class="text-center">
                                                        <td class="text-center">
                                                            <span t-esc="line.get('CdgItem').get('VlrCodigo')"
                                                                  t-options="{'widget': 'text'}"/>
                                                        </td>
                                                        <td class="text-left pl-1">
                                                            <span t-esc="line.get('NmbItem')"
                                                                  t-options="{'widget': 'text'}"/>
                                                        </td>
                                                        <td class="text-center pl-1">
                                                            <span t-esc="line.get('QtyItem')"/>
                                                        </td>
                                                        <td class="text-center">
                                                            <span t-esc="float(line.get('PrcItem'))"
                                                                  t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/>
                                                        </td>
                                                        <td class="text-center">
                                                            <span>--</span>
                                                        </td>
                                                        <td class="text-center">
                                                            <span t-esc="line.get('DescuentoPct')"/>
                                                        </td>
                                                        <td class="text-right pr-1">
                                                            <span
                                                                    t-esc="float(line.get('MontoItem'))"
                                                                    t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/>
                                                        </td>
                                                    </tr>
                                                </t>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="row mt-3 mb-3">
                                    <div class="col-12">
                                        <table class="col-12">
                                            <tbody class="detail-invoice">
                                                <tr>
                                                    <td width="50%" style="border-right: 1px solid white !important;">
                                                        <div t-if="doc.sii_barcode_img" class="text-center mt-2">
                                                            <div class="col-12">
                                                                <span>
                                                                    <img t-att-src="'data:image/png;base64,%s' % to_text(doc.sii_barcode_img)"
                                                                         style="max-height:3cm; max-width:10cm;"
                                                                         t-att-widget="'image'"/>
                                                                </span>
                                                            </div>
                                                            <div class="col-12">
                                                                <p style="text-align:center;font-size:11px;">
                                                                    Timbre Electrónico SII
                                                                    <br/>
                                                                    Resolución SII Nº
                                                                    <t t-esc='doc.company_id.dte_resolution_number'/>
                                                                    del
                                                                    <t t-esc='doc.company_id.dte_resolution_date.strftime("%Y")'/>
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td width="50%" align="right"
                                                        style="vertical-align:top !important; border-left: 1px solid white !important;">
                                                        <div class="col-8 mt-2 pr-0 pl-0" style="float: left;">
                                                            <strong>MONTO NETO: </strong><br/>
                                                            <strong class="mt-1" style="display:inline-block;">
                                                                MONTO EXENTO:</strong><br/>
                                                            <strong class="mt-1" style="display:inline-block;">
                                                                IVA <span t-if="xml_totals.get('TasaIVA')"
                                                                          t-esc="xml_totals['TasaIVA']"/>%:
                                                            </strong><br/>
                                                            <strong class="mt-1" style="display:inline-block;">
                                                                IMPUESTO ADICIONAL:</strong>
                                                            <hr/>
                                                            <strong>TOTAL:</strong>
                                                        </div>
                                                        <div class="col-4 mt-2 pr-0 pl-0" style="float: left;">
                                                            <span t-if="xml_totals.get('MntNeto')" class="pr-2"
                                                                  t-esc="float(xml_totals['MntNeto'])"
                                                                  t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/>
                                                            <span t-else="" class="pr-2" t-esc="0.0"
                                                                  t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/>
                                                            <br/>
                                                            <span class="mt-1 pr-2" style="display:inline-block;"
                                                                  t-if="xml_totals.get('MntExe')"
                                                                  t-esc="float(xml_totals['MntExe'])"
                                                                  t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/>
                                                            <span t-else="" class="mt-1 pr-2" t-esc="0.0"
                                                                  t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/>
                                                            <br/>
                                                            <span class="mt-1 pr-2" style="display:inline-block;"
                                                                  t-if="xml_totals.get('IVA')"
                                                                  t-esc="float(xml_totals['IVA'])"
                                                                  t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/>
                                                            <span t-else="" class="mt-1 pr-2" t-esc="0.0"
                                                                  t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/>
                                                            <br/>
                                                            <span class="mt-1 pr-2" style="display:inline-block;"
                                                                  t-esc="0.0"
                                                                  t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/>
                                                            <hr/>
                                                            <span class="pr-2" t-esc="float(xml_totals['MntTotal'])"
                                                                  t-if="xml_totals.get('MntTotal')"
                                                                  t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/>
                                                            <span t-else="" class="pr-2" t-esc="0.0"
                                                                  t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </t>
                </t>


            </t>
        </template>


        <!--        <record id="report_mail_message_dte_document" model="ir.actions.report">-->
        <!--            <field name="name">Documento (PDF)</field>-->
        <!--            <field name="model">mail.message.dte.document</field>-->
        <!--            <field name="report_type">qweb-pdf</field>-->
        <!--            <field name="report_name">mblz_la_invernada.action_report_mail_message_dte_document</field>-->
        <!--            <field name="report_file">mblz_la_invernada.action_report_mail_message_dte_document</field>-->
        <!--            <field name="paperformat_id" ref="mblz_la_invernada.dte_document_a4_paperformat"/>-->
        <!--            <field name="attachment_use">False</field>-->
        <!--        </record>-->


    </data>
</odoo>
