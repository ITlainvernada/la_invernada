<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<!--  inactivar vista que agrega descuentos, 
		ya que espera que haya una variable line 
		pero al agrupar por plantilla se cambia el nombre de la variable a l-->
	<record id="generic_purchase.report_purchaseorder_document" model="ir.ui.view">
		<field name="active" eval="False" />
	</record>
	
	<template id="report_purchaseorder_document_dusal"
		inherit_id="dusal_purchase.report_purchaseorder_document_dusal">
		<xpath expr="//td[@t-if='o.print_image']" position="replace">
			<td t-if="o.print_image">
				<span t-if="o.image_size == 'small'"><img t-if="l['product_image_small']" t-att-src="'data:image/png;base64,%s' % to_text(l['product_image_small'])" width="32" height="32" /></span>
				<span t-if="o.image_size == 'medium'"><img t-if="l['product_image_medium']" t-att-src="'data:image/png;base64,%s' % to_text(l['product_image_medium'])" width="64" height="64" /></span>
				<span t-if="o.image_size == 'original'"><img t-if="l['product_image']" t-att-src="'data:image/png;base64,%s' % to_text(l['product_image'])" width="128" height="128" /></span>
			</td>
		</xpath>
	</template>

	<template id="report_purchaseorder_document" inherit_id="purchase.report_purchaseorder_document"
		priority="10">
		<xpath expr="//div[hasclass('page')]" position="attributes">
			<attribute name="style">font-size:10px;</attribute>
		</xpath>
		<xpath expr="//div[@t-if='o.name']/.." position="attributes">
			<attribute name="class">row</attribute>
		</xpath>
		<xpath expr="//tr[@t-foreach='o.order_line']/../.." position="replace">
			<!-- Is there a discount on at least one line? -->
			<t t-set="display_discount" t-value="any([l.discount for l in o.order_line])" />
			<t t-set="quantity_total" t-value="0" />
			<table class="table table-sm" style="padding:10px;">
				<thead>
					<tr>
						<th style="min-width:75px;max-width:75px;">CÃ³digo</th>
						<th style="min-width:125px;max-width:125px;">Detalle</th>
						<t t-if="show_atributes_on_reports== 'show_attributes'">
							<th class="text-center" groups="product.group_product_variant">Color</th>
							<th class="text-center" groups="product.group_product_variant">Tallas</th>
						</t>
						<th>Cantidad</th>
						<th style="min-width:60px;max-width:60px;" class="text-right">P. Unit.
						</th>
						<th t-if="display_discount" class="text-left"
							groups="sale.group_discount_per_so_line">Desc.(%)
						</th>
						<th style="min-width:70px;max-width:70px;" class="text-right">Total</th>
					</tr>
				</thead>
				<tbody>
					<tr t-foreach="get_lines(o, False)" t-as="l" style="font-size:10px;">
						<t t-set="quantity_total" t-value="quantity_total+l['quantity']" />
						<td>
							<span t-esc="l['default_code']" />
						</td>
						<td
							style="min-width:125px;max-width:125px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
							<span t-esc="l['name']" />
						</td>
						<t t-if="show_atributes_on_reports== 'show_attributes'">
							<td groups="product.group_product_variant">
								<span t-esc="l['color']" />
							</td>
							<td groups="product.group_product_variant">
								<span t-raw="', '.join(l['attributes'])" />
							</td>
						</t>
						<td class="text-right">
							<span t-esc="l['quantity']"
								t-options="{'widget': 'float', 'decimal_precision': 'Product Unit of Measure'}" />
							<span t-esc="l['product_uom']" groups="uom.group_uom"/>
						</td>
						<td class="text-right">
							<span t-esc="l['price_unit']"
								t-options="{'widget': 'monetary', 'display_currency': o.currency_id}" />
						</td>
						<td t-if="display_discount" class="text-right"
							groups="sale.group_discount_per_so_line">
							<span t-esc="l['discount']" />
						</td>
						<td class="text-right">
							<span t-esc="l['price_subtotal']"
								t-options="{'widget': 'monetary', 'display_currency': o.currency_id}" />
						</td>
					</tr>
				</tbody>
				<tfoot t-if="o.company_id.print_total_qty_reports">
					<tr class="row-no-bordered">
						<td t-if="o.print_line_number"></td>
						<td t-if="o.print_image"></td>
						<td></td>
						<t t-if="show_atributes_on_reports== 'show_attributes'">
							<td groups="product.group_product_variant"></td>
							<td groups="product.group_product_variant"></td>
						</t>
						<td class="text-right row-no-bordered">Total:</td>
						<td class="text-right row-no-bordered">
							<span t-esc="quantity_total"
								t-options="{'widget': 'float', 'decimal_precision': 'Product Unit of Measure'}"/>
						</td>
						<td groups="uom.group_uom">
						</td>
						<td class="text-right row-no-bordered">
						</td>
						<td t-if="display_discount" class="text-right"
							groups="sale.group_discount_per_so_line">
						</td>
						<td class="text-right">
						</td>
					</tr>
				</tfoot>
			</table>
		</xpath>
	</template>
</odoo>
