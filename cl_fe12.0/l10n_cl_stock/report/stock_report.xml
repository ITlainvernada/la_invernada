<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<template id="dte_references" t-name="dte_references">
		<div class="mb8" style="min-height:20px;"
			name="reference">
			<table class="table table-sm table-bordered-line" style="padding:10px;">
				<thead>
					<tr class="row-bordered" style="background-color: #FFFF99;">
						<th>
							<strong>Folio:</strong>
						</th>
						<th>
							<strong>Referencia:</strong>
						</th>
						<th>
							<strong>Fecha:</strong>
						</th>
					</tr>
				</thead>
				<tbody>
					<t t-if="'reference' in o and o.reference">
						<t t-foreach="o.reference" t-as="l">
							<tr style="max-height:8px;line-height:10px !important;">
								<td style="border-top:0px !important;padding:0px !important;">
									<span t-if="l.origen" t-field="l.origen" />
								</td>
								<td style="border-top:0px !important;padding:0px !important;">
									<span t-if="l.sii_referencia_TpoDocRef" t-field="l.sii_referencia_TpoDocRef.name" />
								</td>
								<td style="border-top:0px !important;padding:0px !important;">
									<span t-if="l.date" t-field="l.date" />
								</td>
							</tr>
						</t>
					</t>
					<t t-else="">
						<tr class="text-center" style="max-height:15px; font-size:12px !important;">
							<td style="max-height:8px;line-height:10px !important;">-</td>
							<td name="reference" style="max-height:8px;line-height:10px !important;">-</td>
							<td style="max-height:8px;line-height:10px !important;">-</td>
						</tr>
					</t>
				</tbody>
				<tfoot>
					<tr class="row-no-bordered">
						<td></td>
						<td></td>
						<td></td>
					</tr>
				</tfoot>
			</table>
		</div>
	</template>
	
	<template id="l10n_cl_stock_picking.dte_stock_picking">
		<t t-call="web.html_container">
			<t t-foreach="docs" t-as="o">
				<t t-call="web.basic_layout">
				<t t-lang="o.partner_id.lang">
					<!-- Multicompany -->
					<t t-if="not o and doc">
						<t t-set="o" t-value="doc" />
					</t>
					<t t-if="o and 'company_id' in o">
						<t t-set="company" t-value="o.company_id"></t>
					</t>
					<t t-if="not o or not 'company_id' in o">
						<t t-set="company" t-value="res_company"></t>
					</t>
					<t t-if="'picking_type_id' in o and o.location_id.sii_document_class_id">
						<t t-set="document_class_id" t-value="o.location_id.sii_document_class_id" />
					</t>
					<t t-set="partner_id" t-value="o.partner_id" />
					<t t-set="commercial_partner_id" t-value="o.partner_id.commercial_partner_id" />
					<t t-set="logo" t-value="company.logo" />
					<t t-set="sii_document_number" t-value="o.sii_document_number" />
					<t t-call="l10n_cl_fe.dte_header" />
					<div class="page" style="padding-top:5px;">
						<div class="row">
							<div class="col-12"
								style="text-align: right; margin-top:0px !important; padding-top:0px!important;">
									<span t-field="company.state_id.name" />, <span t-field="o.scheduled_date" t-options="{'format': 'd \'de\' LLLL \'de\' Y'}"/>
							</div>
						</div>
						<t t-set="page_detail_height" t-value="540" />
						<t t-call="l10n_cl_fe.dte_header_customer" />
						<t t-set="style_detail" t-value="'min-height:%spx; max-height:%spx;' % (page_detail_height, page_detail_height)" />
						<div t-att-style="style_detail" class="row">
							<!-- Is there a discount on at least one line? -->
							<t t-set="display_discount" t-value="any([l.discount for l in o.move_lines])" />
							<t t-call="l10n_cl_fe.dte_detail" />
						</div>
						<table class="table table-sm" style="border:1px solid black; height:30px;">
							<thead>
								<tr
									style="max-height:10px; font-size:9px !important; border:1px solid black;">
									<th>Nombre </th>
									<th> RUT </th>
									<th name="td_sched_date_h">Patente</th>
									<th>Traslado</th>
								</tr>
								<tr
									style="max-height:9px; font-size:8px !important; border:1px solid black;">
									<td>
										<span t-field="o.chofer.name" />
									</td>
									<td>
										<span t-field="o.chofer.document_number" />
									</td>
									<td name="td_sched_date">
										<span t-field="o.patente" />
									</td>
									<td>
										<span t-field="o.move_reason" />
									</td>
								</tr>
							</thead>
						</table>
						<p t-if="o.note">
							<strong>Observación:</strong>
							<span t-field="o.note" />
						</p>
						<div class="row">
							<div class="col-7">
								<t t-call="l10n_cl_stock.dte_references" />
							</div>
							<div id="total" class="col-4 offset-1">
								<table class="table table-sm">
									<tr style="max-height:11px; font-size:12px !important;" name="subtotal">
										<td>
											<strong>Monto Neto</strong>
										</td>
										<td class="text-right">
											<span t-field="o.amount_untaxed"
												t-options="{'widget': 'monetary', 'display_currency': o.currency_id}" />
										</td>
									</tr>
									<tr name="discount" t-if="display_discount" class="border-black"
										style="max-height:11px; font-size:12px !important;">
										<td>
											<strong>Descuento</strong>
										</td>
										<td class="text-right">
											<span t-esc="o.getTotalDiscount()"
												t-options="{'widget': 'monetary', 'display_currency': o.currency_id}" />
										</td>
									</tr>
									<tr name="amount_tax" t-if="o.amount_tax > 0"
										style="max-height:11px; font-size:12px !important;">
										<td>
											<strong>IVA</strong>
										</td>
										<td class="text-right">
											<span t-field="o.amount_tax"
												t-options='{"widget": "monetary", "display_currency": o.currency_id}' />
										</td>
									</tr>
									<tr class="border-black" style="max-height:12px; font-size:12px !important;">
										<td>
											<strong>Total</strong>
										</td>
										<td class="text-right">
											<span t-field="o.amount_total"
												t-options="{'widget': 'monetary', 'display_currency': o.currency_id}" />
										</td>
									</tr>
								</table>
							</div>
						</div>
						<div class="row">
							<div class="col-5">
								<t t-call="l10n_cl_fe.dte_sii_barcode" />
							</div>
							<div class="col-6 offset-1">
								<t t-if="cedible">
									<t t-call="l10n_cl_fe.dte_sii_cedible" />
								</t>
							</div>
						</div>
					</div>
				</t>
				</t>
			</t>
		</t>
	</template>

	<record id="stock.action_report_picking" model="ir.actions.report">
		<field name="paperformat_id" ref="l10n_cl_fe.paperformat_sii_document_electronic_a4" />
	</record>
	
	<record id="l10n_cl_stock_picking.action_print_guia_electronica_stock"
		model="ir.actions.report">
		<field name="paperformat_id" ref="l10n_cl_fe.paperformat_sii_document_electronic_a4" />
	</record>

	<record id="l10n_cl_stock_picking.action_print_stock_cedible"
		model="ir.actions.report">
		<field name="paperformat_id" ref="l10n_cl_fe.paperformat_sii_document_electronic_a4" />
	</record>
	
	<template id="report_picking_document" inherit_id="stock.report_picking_document"
		priority="10">
		<xpath expr="//t[@t-set='has_serial_number']" position="after">
			<t t-set="number" t-value="0"/>
		</xpath>
		<xpath expr="//table[@t-if='o.move_line_ids']/thead/tr/th[1]" position="before">
	        <th t-if="o.print_line_number"><strong>No.</strong></th>
	    </xpath>
	    <xpath expr="//span[@t-field='ml.product_id.display_name']/.." position="before">
	        <td t-if="o.print_line_number">
	            <t t-set="number" t-value="number+1"/>
	            <span t-esc="number"/>
	        </td>
        </xpath>
	</template>

	<template id="report_delivery_document" inherit_id="stock.report_delivery_document"
		priority="10">
		<xpath expr="//div[@class='page']" position="attributes">
			<attribute name="style">font-size:10px;</attribute>
		</xpath>
		<xpath expr="//t[@t-set='lines']/../.." position="replace">
			<table class="table table-sm mt48" t-if="o.state!='done'"
				style="padding:10px;">
				<thead>
					<tr>
						<th style="min-width:75px;max-width:75px;">Código</th>
						<th style="min-width:125px;max-width:125px;">Detalle</th>
						<th class="text-center">Color</th>
						<th class="text-center">Tallas</th>
						<th>Cantidad Pedida</th>
					</tr>
				</thead>
				<tbody>
					<tr t-foreach="get_lines(o)" t-as="l" style="font-size:10px;">
						<td>
							<span t-esc="l['default_code']" />
						</td>
						<td
							style="min-width:125px;max-width:125px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
							<span t-esc="l['name']" />
						</td>
						<td>
							<span t-esc="l['color']" />
						</td>
						<td>
							<span t-raw="', '.join(l['attributes'])" />
						</td>
						<td class="text-right">
							<span t-esc="l['quantity']"
								t-options="{'widget': 'float', 'decimal_precision': 'Product Unit of Measure'}"/>
						</td>
					</tr>
				</tbody>
			</table>
		</xpath>
		<xpath expr="//t[@t-set='has_serial_number']/.." position="replace">
			<table class="table table-sm mt48" t-if="o.move_line_ids and o.state=='done'"
				style="padding:10px;">
				<t t-set="has_serial_number" t-value="o.move_line_ids.mapped('lot_id')"
					groups="stock.group_production_lot" />
				<thead>
					<tr>
						<th style="min-width:75px;max-width:75px;">Código</th>
						<th style="min-width:125px;max-width:125px;">Detalle</th>
						<t t-if="show_atributes_on_reports== 'show_attributes'">
							<th class="text-center" groups="product.group_product_variant">Color</th>
							<th class="text-center" groups="product.group_product_variant">Tallas</th>
						</t>
						<th>Cantidad Pedida</th>
						<th>Cantidad Entregada</th>
					</tr>
				</thead>
				<tbody>
					<tr t-foreach="get_lines(o)" t-as="l" style="font-size:10px;">
						<td>
							<span t-esc="l['default_code']" />
						</td>
						<td
							style="min-width:125px;max-width:125px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
							<span t-esc="l['name']" />
						</td>
						<t t-if="show_atributes_on_reports== 'show_attributes'">
							<td style="max-height:8px;line-height:10px !important;" groups="product.group_product_variant">
								<span t-esc="l['color']" />
							</td>
							<td style="max-height:8px;line-height:10px !important;" groups="product.group_product_variant">
								<span t-raw="', '.join(l['attributes'])" />
							</td>
						</t>
						<td class="text-right">
							<span t-esc="l['ordered_qty']"
								t-options="{'widget': 'float', 'decimal_precision': 'Product Unit of Measure'}"/>
						</td>
						<td class="text-right">
							<span t-esc="l['qty_done']"
								t-options="{'widget': 'float', 'decimal_precision': 'Product Unit of Measure'}"/>
						</td>
					</tr>
				</tbody>
			</table>
		</xpath>
	</template>

</odoo>