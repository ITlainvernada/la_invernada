<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
    	<template id="line">
			<hr style="border-width: 1px;border-color: black;" />
		</template>
		<template id="dline">
			<hr style="border-width: 2px;border-color: black;" />
		</template>
        <template id="pos_z_report_template">
            <t t-call="web.html_container">
				<t t-foreach="docs" t-as="o">
					<t t-if="o and 'company_id' in o">
						<t t-set="company" t-value="o.company_id.sudo()" />
					</t>
					<t t-if="not o or not 'company_id' in o">
						<t t-set="company" t-value="res_company" />
					</t>
					<t t-call="web.basic_layout">
						<div class="page small">
							<div class="text-center">
								<img t-if="company.logo"
									t-att-src="'data:image/png;base64,%s' % to_text(company.logo)"
									style="height: 80px;" />
							</div>
							<center>
								<b>RESUMEN DE SESION</b>
							</center>
							<strong>Usuario </strong>
							<span t-field="o.user_id" />
							<br />
							<strong>Fecha de apertura:</strong>
							<span t-field="o.start_at" />
							<br />
							<strong>Fecha de cierre:</strong>
							<span t-field="o.stop_at" />
							<br />
							<strong>Numero de Tickets:</strong>
							<span t-esc="o.tickets_num" />
							<br />
							<strong>Desde:</strong>
							<span t-field="o.ticket_first_id.display_name" />
							<br />
							<strong>Hasta:</strong>
							<span t-field="o.ticket_last_id.display_name" />
							<t t-call="aspl_pos_close_session.line" />
							<center>
								<b>Resumen por Métodos de pago</b>
							</center>
							<table class="table table-sm">
								<tbody>
									<tr t-foreach="o.statement_ids" t-as="i">
										<td>
											<span t-field="i.journal_id.name" /> (<span t-field="i.payment_count" />)
										</td>
										<td class="text-right">
											<!-- si es el diario de efectivo, mostrar solo las ventas, no saldo inicial ni ingresos/egreos
												pero otros diarios si mostrar ingresos y egresos, para que no haya descuadre -->
											<t t-if="i == o.cash_register_id">
												<span t-field="i.total_entry_encoding_custom" />
											</t>
											<t t-if="i != o.cash_register_id">
												<span t-field="i.total_entry_encoding" />
											</t>
										</td>
									</tr>
								</tbody>
							</table>
							<t t-call="aspl_pos_close_session.line" />
							<table class="table table-sm">
								<tbody>
									<tr>
										<td>Pagos totales recibidos:</td>
										<td class="text-right">
											<span t-field="o.statements_total" />
										</td>
									</tr>
									<tr>
										<td>Otros Medios:</td>
										<td class="text-right">
											<span t-field="o.statements_bank_total" />
										</td>
									</tr>
								</tbody>
							</table>
							<t t-if="abs(o.statements_cn_total) > 0">
								<t t-call="aspl_pos_close_session.dline" />
								<br />
								<center>
									<b>Notas de Crédito</b>
								</center>
								<table class="table table-sm">
									<tbody>
										<tr t-foreach="o.statement_ids" t-as="i">
											<t t-if="abs(i.total_entry_encoding_cn)>0">
												<td>
													<span t-field="i.journal_id" />
												</td>
												<td class="text-right">
													<span t-field="i.total_entry_encoding_cn" />
												</td>
											</t>
										</tr>
										<tr>
											<td>
												<b>Total NC:</b>
											</td>
											<td class="text-right">
												<b>
													<span t-field="o.statements_cn_total" />
												</b>
											</td>
										</tr>
									</tbody>
								</table>
							</t>
							<t t-call="aspl_pos_close_session.dline" />
							<br />
							<center>
								<b>Control Efectivo</b>
							</center>
							<table class="table table-sm">
								<tbody>
									<tr>
										<td>Saldo de apertura:</td>
										<td class="text-right">
											<span t-field="o.cash_register_balance_start" />
										</td>
									</tr>
									<tr>
										<td>+ ventas</td>
										<td class="text-right">
											<span t-field="o.cash_register_total_entry_encoding_custom" />
										</td>
									</tr>
									<tr>
										<td>+ Ingreso Efectivo </td>
										<td class="text-right">
											<span t-field="o.cash_register_total_entry_encoding_put_in" />
										</td>
									</tr>
									<tr>
										<td>- Egreso Efectivo </td>
										<td class="text-right">
											<span t-field="o.cash_register_total_entry_encoding_take_out" />
										</td>
									</tr>
									<tr>
										<td>- Depositos </td>
										<td class="text-right">
											<span t-field="o.cash_register_total_entry_encoding_deposit" />
										</td>
									</tr>
									<tr>
										<td>- Notas de Credito </td>
										<td class="text-right">
											<span t-field="o.cash_register_id.total_entry_encoding_cn" />
										</td>
									</tr>
									<tr>
										<td>(+/-) Ajustes de cierre </td>
										<td class="text-right">
											<span t-field="o.cash_register_total_entry_encoding_adjustment" />
										</td>
									</tr>
								</tbody>
							</table>
							<t t-call="aspl_pos_close_session.line" />
							<table class="table table-sm">
								<tbody>
									<tr>
										<td>Saldo de cierre:</td>
										<td class="text-right">
											<span t-field="o.cash_register_balance_end_real" />
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</t>
				</t>
			</t>
        </template>
    </data>
</odoo>
