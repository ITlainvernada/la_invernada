<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<template id="pos_session_resume">
		<t t-call="web.html_container">
			<t t-foreach="docs" t-as="o">
				<t t-if="o and 'company_id' in o">
					<t t-set="company" t-value="o.company_id.sudo()" />
				</t>
				<t t-if="not o or not 'company_id' in o">
					<t t-set="company" t-value="res_company" />
				</t>
				<t t-call="web.basic_layout">
					<t t-set="warehouse_data" t-value="get_warehouse_data(o, date_from, date_to)" />
					<div class="page small">
						<div class="text-center">
							<img t-if="company.logo"
								t-att-src="'data:image/png;base64,%s' % to_text(company.logo)"
								style="height: 80px;" />
						</div>
						<center>
							<b>RESUMEN DE SESION</b>
						</center>
						<p>
							<b>Tienda:</b>
							<span t-esc="o.display_name" />
							<br />
							<b>Fecha de inicio:</b>
							<span t-esc="date_from" t-options="{'widget': 'datetime'}" />
							<br />
							<b>Fecha de fin:</b>
							<span t-esc="date_to" t-options="{'widget': 'datetime'}" />
						</p>
						<p>
							<strong>Numero de Tickets:</strong>
							<span t-esc="warehouse_data.get('tickets_num', 0)" />
							<br />
							<strong>Desde:</strong>
							<span t-esc="warehouse_data.get('ticket_first_id').pos_reference" />
							<br />
							<strong>Hasta:</strong>
							<span t-esc="warehouse_data.get('ticket_last_id').pos_reference" />
						</p>
						<t t-call="aspl_pos_close_session.line" />
						<center>
							<b>Resumen por Métodos de pago</b>
						</center>
						<table class="table table-sm">
							<tbody>
								<tr t-foreach="warehouse_data.get('statement_data', {})"
									t-as="journal">
									<td>
										<span t-esc="journal.name" />(<span t-esc="warehouse_data.get('statement_data', {})[journal]['payment_count']" />)
									</td>
									<td class="text-right">
										<span t-esc="warehouse_data.get('statement_data', {})[journal]['amount']"
											t-options="{'widget': 'monetary', 'display_currency': company.currency_id}" />
									</td>
								</tr>
							</tbody>
						</table>
						<t t-call="aspl_pos_close_session.line" />
						<table class="table table-sm" id="table_total_payments">
							<tbody>
								<tr>
									<td>Pagos totales recibidos:</td>
									<td class="text-right">
										<span t-esc="warehouse_data.get('statements_total', 0)"
											t-options="{'widget': 'monetary', 'display_currency': company.currency_id}" />
									</td>
								</tr>
								<tr>
									<td>Otros Medios:</td>
									<td class="text-right">
										<span t-esc="warehouse_data.get('statements_bank_total', 0)"
											t-options="{'widget': 'monetary', 'display_currency': company.currency_id}" />
									</td>
								</tr>
							</tbody>
						</table>
						<t t-if="abs(warehouse_data.get('statements_cn_total', 0)) > 0">
							<t t-call="aspl_pos_close_session.dline" />
							<br />
							<center>
								<b>Notas de Crédito</b>
							</center>
							<table class="table table-sm">
								<tbody>
									<tr t-foreach="warehouse_data.get('statement_cn_data', {})"
										t-as="journal">
										<td>
											<span t-esc="journal.name" />
										</td>
										<td class="text-right">
											<span t-esc="warehouse_data.get('statement_cn_data', {})[journal]['amount']"
												t-options="{'widget': 'monetary', 'display_currency': company.currency_id}" />
										</td>
									</tr>
									<tr>
										<td>
											<b>Total NC:</b>
										</td>
										<td class="text-right">
											<b>
												<span t-esc="warehouse_data.get('statements_cn_total', 0)"
													t-options="{'widget': 'monetary', 'display_currency': company.currency_id}" />
											</b>
										</td>
									</tr>
								</tbody>
							</table>
						</t>
						<t t-call="aspl_pos_close_session.dline" />
						<br />
						<center>
							<b>Control Efectivo</b>
						</center>
						<table class="table table-sm">
							<tbody>
								<tr>
									<td>Saldo de apertura:</td>
									<td class="text-right">
										<span t-esc="warehouse_data.get('cash_register_balance_start', 0)"
											t-options="{'widget': 'monetary', 'display_currency': company.currency_id}" />
									</td>
								</tr>
								<tr>
									<td>+ ventas</td>
									<td class="text-right">
										<span
											t-esc="warehouse_data.get('cash_register_total_entry_encoding_custom', 0)"
											t-options="{'widget': 'monetary', 'display_currency': company.currency_id}" />
									</td>
								</tr>
								<tr>
									<td>+ Ingreso Efectivo </td>
									<td class="text-right">
										<span
											t-esc="warehouse_data.get('cash_register_total_entry_encoding_put_in', 0)"
											t-options="{'widget': 'monetary', 'display_currency': company.currency_id}" />
									</td>
								</tr>
								<tr>
									<td>- Egreso Efectivo </td>
									<td class="text-right">
										<span
											t-esc="warehouse_data.get('cash_register_total_entry_encoding_take_out', 0)"
											t-options="{'widget': 'monetary', 'display_currency': company.currency_id}" />
									</td>
								</tr>
								<tr>
									<td>- Depositos </td>
									<td class="text-right">
										<span
											t-esc="warehouse_data.get('cash_register_total_entry_encoding_deposit', 0)"
											t-options="{'widget': 'monetary', 'display_currency': company.currency_id}" />
									</td>
								</tr>
								<tr>
									<td>- Notas de Credito </td>
									<td class="text-right">
										<span
											t-esc="warehouse_data.get('statements_cn_total', 0)"
											t-options="{'widget': 'monetary', 'display_currency': company.currency_id}" />
									</td>
								</tr>
								<tr>
									<td>(+/-) Ajustes de cierre </td>
									<td class="text-right">
										<span
											t-esc="warehouse_data.get('cash_register_total_entry_encoding_adjustment', 0)"
											t-options="{'widget': 'monetary', 'display_currency': company.currency_id}" />
									</td>
								</tr>
							</tbody>
						</table>
						<t t-call="aspl_pos_close_session.line" />
						<table class="table table-sm">
							<tbody>
								<tr>
									<td>Saldo de cierre teórico:</td>
									<td class="text-right">
										<span t-esc="warehouse_data.get('cash_register_balance_end', 0)"
											t-options="{'widget': 'monetary', 'display_currency': company.currency_id}" />
									</td>
								</tr>
							</tbody>
						</table>
						<t t-call="aspl_pos_close_session.line" />
						<table class="table table-sm">
							<tbody>
								<tr>
									<td>Saldo de cierre real:</td>
									<td class="text-right">
										<span
											t-esc="warehouse_data.get('cash_register_balance_end_real', 0)"
											t-options="{'widget': 'monetary', 'display_currency': company.currency_id}" />
									</td>
								</tr>
							</tbody>
						</table>
						<t t-call="aspl_pos_close_session.dline" />
						<table class="table table-sm">
							<tbody>
								<tr>
									<td>Diferencia:</td>
									<td class="text-right">
										<span t-esc="warehouse_data.get('cash_register_difference', 0)"
											t-options="{'widget': 'monetary', 'display_currency': company.currency_id}" />
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</t>
			</t>
		</t>
	</template>

	<report id="pos_session_resume_report" model="stock.warehouse"
		string="Resumen de Caja" report_type="qweb-pdf"
		name="aspl_pos_close_session.pos_session_resume" file="aspl_pos_close_session.pos_session_resume"
		paperformat="paperformat_session_receipt_pdf" menu="False" />
</odoo>
