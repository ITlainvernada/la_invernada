<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="update_lot_pallet" model="ir.actions.server">
            <field name="name">Actualizar Lotes de Pallets</field>
            <field name="model_id" ref="mail.model_ir_actions_server"/>
            <field name="state">code</field>
            <field name="code">pallets = env['manufacturing.pallet'].search([])
for pallet in pallets:
  pallet.write({
    'lot_id':pallet.lot_serial_ids.mapped('stock_production_lot_id').id
  })
            </field>
        </record>
        <record id="update_quant_lot" model="ir.actions.server">
            <field name="name">Actualizar Quant</field>
            <field name="model_id" ref="mail.model_ir_actions_server"/>
            <field name="state">code</field>
            <field name="code">lots = env['stock.production.lot'].search([('name','=','201915090')])
for lot in lots:
  quant = env['stock.quant'].search([('lot_id','=',lot.id),('location_id.usage','=','internal')])
  quant.write({
    'reserved_quantity':sum(lot.stock_production_lot_serial_ids.filtered(lambda x: x.reserved_to_stock_picking_id and x.reserved_to_stock_picking_id.state != 'done' and not x.consumed).mapped('display_weight')),
    'quantity':sum(lot.stock_production_lot_serial_ids.filtered(lambda x: not x.reserved_to_stock_picking_id and not x.consumed).mapped('display_weight'))
  })
            </field>
        </record>
    </data>
</odoo>